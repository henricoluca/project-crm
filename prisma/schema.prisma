// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             Int      @id @default(autoincrement())
  email          String   @unique
  name           String
  password       String
  recordsCreated Record[] @relation("RecordCreatedBy")

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

enum CompanyStatus {
  ATIVA
  INATIVA
}

enum InactivationReason {
  INADIMPLENCIA
  PEDIDO_CLIENTE
  FALENCIA
  OUTRO
}

model Company {
  id                  Int                  @id @default(autoincrement())
  corporateName       String
  address             String
  phone               String
  cnpj                String               @unique
  tags                String[]             @default([])
  status              CompanyStatus        @default(ATIVA)
  inactivationReasons InactivationReason[] @default([])
  records             Record[]
  contacts            Contact[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ContactStatus {
  ATIVO
  INATIVO
}

model Contact {
  id        Int           @id @default(autoincrement())
  name      String
  celular   String
  email     String        @unique
  status    ContactStatus @default(ATIVO)
  companyId Int
  company   Company       @relation(fields: [companyId], references: [id])
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([companyId])
  @@index([status])
}

enum RecordType {
  APRESENTACAO
  ORCAMENTO
  NOTA_FISCAL
  OUTRO
}

model Record {
  id                  Int        @id @default(autoincrement())
  sentDate            DateTime
  lectureConfirmation Boolean    @default(false)
  type                RecordType
  observation         String?

  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdById Int?
  createdBy   User? @relation("RecordCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([createdById])
}
